var ht=Object.defineProperty;var yt=(t,e,n)=>e in t?ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var F=(t,e,n)=>yt(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();var ae,y,qe,Be,$,Pe,Qe,pe,Ae,he,ye,j={},Ye=[],mt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ke=Array.isArray;function C(t,e){for(var n in e)t[n]=e[n];return t}function je(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function St(t,e,n){var i,o,r,s={};for(r in e)r=="key"?i=e[r]:r=="ref"?o=e[r]:s[r]=e[r];if(arguments.length>2&&(s.children=arguments.length>3?ae.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(r in t.defaultProps)s[r]===void 0&&(s[r]=t.defaultProps[r]);return ne(t,s,i,o,null)}function ne(t,e,n,i,o){var r={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:o??++qe,__i:-1,__u:0};return o==null&&y.vnode!=null&&y.vnode(r),r}function ce(t){return t.children}function Q(t,e){this.props=t,this.context=e}function U(t,e){if(e==null)return t.__?U(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?U(t):null}function ze(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return ze(t)}}function Oe(t){(!t.__d&&(t.__d=!0)&&$.push(t)&&!oe.__r++||Pe!==y.debounceRendering)&&((Pe=y.debounceRendering)||Qe)(oe)}function oe(){var t,e,n,i,o,r,s,c;for($.sort(pe);t=$.shift();)t.__d&&(e=$.length,i=void 0,r=(o=(n=t).__v).__e,s=[],c=[],n.__P&&((i=C({},o)).__v=o.__v+1,y.vnode&&y.vnode(i),Le(n.__P,i,o,n.__n,n.__P.namespaceURI,32&o.__u?[r]:null,s,r??U(o),!!(32&o.__u),c),i.__v=o.__v,i.__.__k[i.__i]=i,Xe(s,i,c),i.__e!=r&&ze(i)),$.length>e&&$.sort(pe));oe.__r=0}function Ze(t,e,n,i,o,r,s,c,l,d,v){var u,S,_,A,P,T=i&&i.__k||Ye,g=e.length;for(n.__d=l,gt(n,e,T),l=n.__d,u=0;u<g;u++)(_=n.__k[u])!=null&&(S=_.__i===-1?j:T[_.__i]||j,_.__i=u,Le(t,_,S,o,r,s,c,l,d,v),A=_.__e,_.ref&&S.ref!=_.ref&&(S.ref&&be(S.ref,null,_),v.push(_.ref,_.__c||A,_)),P==null&&A!=null&&(P=A),65536&_.__u||S.__k===_.__k?l=Je(_,l,t):typeof _.type=="function"&&_.__d!==void 0?l=_.__d:A&&(l=A.nextSibling),_.__d=void 0,_.__u&=-196609);n.__d=l,n.__e=P}function gt(t,e,n){var i,o,r,s,c,l=e.length,d=n.length,v=d,u=0;for(t.__k=[],i=0;i<l;i++)(o=e[i])!=null&&typeof o!="boolean"&&typeof o!="function"?(s=i+u,(o=t.__k[i]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?ne(null,o,null,null,null):ke(o)?ne(ce,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?ne(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,r=null,(c=o.__i=At(o,n,s,v))!==-1&&(v--,(r=n[c])&&(r.__u|=131072)),r==null||r.__v===null?(c==-1&&u--,typeof o.type!="function"&&(o.__u|=65536)):c!==s&&(c==s-1?u--:c==s+1?u++:(c>s?u--:u++,o.__u|=65536))):o=t.__k[i]=null;if(v)for(i=0;i<d;i++)(r=n[i])!=null&&!(131072&r.__u)&&(r.__e==t.__d&&(t.__d=U(r)),Ke(r,r))}function Je(t,e,n){var i,o;if(typeof t.type=="function"){for(i=t.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=t,e=Je(i[o],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=U(t)),n.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function At(t,e,n,i){var o=t.key,r=t.type,s=n-1,c=n+1,l=e[n];if(l===null||l&&o==l.key&&r===l.type&&!(131072&l.__u))return n;if(i>(l!=null&&!(131072&l.__u)?1:0))for(;s>=0||c<e.length;){if(s>=0){if((l=e[s])&&!(131072&l.__u)&&o==l.key&&r===l.type)return s;s--}if(c<e.length){if((l=e[c])&&!(131072&l.__u)&&o==l.key&&r===l.type)return c;c++}}return-1}function Ee(t,e,n){e[0]==="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||mt.test(e)?n:n+"px"}function K(t,e,n,i,o){var r;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||Ee(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||Ee(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")r=e!==(e=e.replace(/(PointerCapture)$|Capture$/i,"$1")),e=e.toLowerCase()in t||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+r]=n,n?i?n.u=i.u:(n.u=Ae,t.addEventListener(e,r?ye:he,r)):t.removeEventListener(e,r?ye:he,r);else{if(o=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Ne(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=Ae++;else if(e.t<n.u)return;return n(y.event?y.event(e):e)}}}function Le(t,e,n,i,o,r,s,c,l,d){var v,u,S,_,A,P,T,g,k,G,N,Z,q,xe,J,de,O=e.type;if(e.constructor!==void 0)return null;128&n.__u&&(l=!!(32&n.__u),r=[c=e.__e=n.__e]),(v=y.__b)&&v(e);e:if(typeof O=="function")try{if(g=e.props,k="prototype"in O&&O.prototype.render,G=(v=O.contextType)&&i[v.__c],N=v?G?G.props.value:v.__:i,n.__c?T=(u=e.__c=n.__c).__=u.__E:(k?e.__c=u=new O(g,N):(e.__c=u=new Q(g,N),u.constructor=O,u.render=Lt),G&&G.sub(u),u.props=g,u.state||(u.state={}),u.context=N,u.__n=i,S=u.__d=!0,u.__h=[],u._sb=[]),k&&u.__s==null&&(u.__s=u.state),k&&O.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=C({},u.__s)),C(u.__s,O.getDerivedStateFromProps(g,u.__s))),_=u.props,A=u.state,u.__v=e,S)k&&O.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),k&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(k&&O.getDerivedStateFromProps==null&&g!==_&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(g,N),!u.__e&&(u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(g,u.__s,N)===!1||e.__v===n.__v)){for(e.__v!==n.__v&&(u.props=g,u.state=u.__s,u.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(X){X&&(X.__=e)}),Z=0;Z<u._sb.length;Z++)u.__h.push(u._sb[Z]);u._sb=[],u.__h.length&&s.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(g,u.__s,N),k&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(_,A,P)})}if(u.context=N,u.props=g,u.__P=t,u.__e=!1,q=y.__r,xe=0,k){for(u.state=u.__s,u.__d=!1,q&&q(e),v=u.render(u.props,u.state,u.context),J=0;J<u._sb.length;J++)u.__h.push(u._sb[J]);u._sb=[]}else do u.__d=!1,q&&q(e),v=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++xe<25);u.state=u.__s,u.getChildContext!=null&&(i=C(C({},i),u.getChildContext())),k&&!S&&u.getSnapshotBeforeUpdate!=null&&(P=u.getSnapshotBeforeUpdate(_,A)),Ze(t,ke(de=v!=null&&v.type===ce&&v.key==null?v.props.children:v)?de:[de],e,n,i,o,r,s,c,l,d),u.base=e.__e,e.__u&=-161,u.__h.length&&s.push(u),T&&(u.__E=u.__=null)}catch(X){if(e.__v=null,l||r!=null){for(e.__u|=l?160:32;c&&c.nodeType===8&&c.nextSibling;)c=c.nextSibling;r[r.indexOf(c)]=null,e.__e=c}else e.__e=n.__e,e.__k=n.__k;y.__e(X,e,n)}else r==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=kt(n.__e,e,n,i,o,r,s,l,d);(v=y.diffed)&&v(e)}function Xe(t,e,n){e.__d=void 0;for(var i=0;i<n.length;i++)be(n[i],n[++i],n[++i]);y.__c&&y.__c(e,t),t.some(function(o){try{t=o.__h,o.__h=[],t.some(function(r){r.call(o)})}catch(r){y.__e(r,o.__v)}})}function kt(t,e,n,i,o,r,s,c,l){var d,v,u,S,_,A,P,T=n.props,g=e.props,k=e.type;if(k==="svg"?o="http://www.w3.org/2000/svg":k==="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),r!=null){for(d=0;d<r.length;d++)if((_=r[d])&&"setAttribute"in _==!!k&&(k?_.localName===k:_.nodeType===3)){t=_,r[d]=null;break}}if(t==null){if(k===null)return document.createTextNode(g);t=document.createElementNS(o,k,g.is&&g),c&&(y.__m&&y.__m(e,r),c=!1),r=null}if(k===null)T===g||c&&t.data===g||(t.data=g);else{if(r=r&&ae.call(t.childNodes),T=n.props||j,!c&&r!=null)for(T={},d=0;d<t.attributes.length;d++)T[(_=t.attributes[d]).name]=_.value;for(d in T)if(_=T[d],d!="children"){if(d=="dangerouslySetInnerHTML")u=_;else if(!(d in g)){if(d=="value"&&"defaultValue"in g||d=="checked"&&"defaultChecked"in g)continue;K(t,d,null,_,o)}}for(d in g)_=g[d],d=="children"?S=_:d=="dangerouslySetInnerHTML"?v=_:d=="value"?A=_:d=="checked"?P=_:c&&typeof _!="function"||T[d]===_||K(t,d,_,T[d],o);if(v)c||u&&(v.__html===u.__html||v.__html===t.innerHTML)||(t.innerHTML=v.__html),e.__k=[];else if(u&&(t.innerHTML=""),Ze(t,ke(S)?S:[S],e,n,i,k==="foreignObject"?"http://www.w3.org/1999/xhtml":o,r,s,r?r[0]:n.__k&&U(n,0),c,l),r!=null)for(d=r.length;d--;)je(r[d]);c||(d="value",k==="progress"&&A==null?t.removeAttribute("value"):A!==void 0&&(A!==t[d]||k==="progress"&&!A||k==="option"&&A!==T[d])&&K(t,d,A,T[d],o),d="checked",P!==void 0&&P!==t[d]&&K(t,d,P,T[d],o))}return t}function be(t,e,n){try{if(typeof t=="function"){var i=typeof t.__u=="function";i&&t.__u(),i&&e==null||(t.__u=t(e))}else t.current=e}catch(o){y.__e(o,n)}}function Ke(t,e,n){var i,o;if(y.unmount&&y.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||be(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){y.__e(r,e)}i.base=i.__P=null}if(i=t.__k)for(o=0;o<i.length;o++)i[o]&&Ke(i[o],e,n||typeof t.type!="function");n||je(t.__e),t.__c=t.__=t.__e=t.__d=void 0}function Lt(t,e,n){return this.constructor(t,n)}function bt(t,e,n){var i,o,r,s;y.__&&y.__(t,e),o=(i=typeof n=="function")?null:e.__k,r=[],s=[],Le(e,t=(!i&&n||e).__k=St(ce,null,[t]),o||j,j,e.namespaceURI,!i&&n?[n]:o?null:e.firstChild?ae.call(e.childNodes):null,r,!i&&n?n:o?o.__e:e.firstChild,i,s),Xe(r,t,s)}ae=Ye.slice,y={__e:function(t,e,n,i){for(var o,r,s;e=e.__;)if((o=e.__c)&&!o.__)try{if((r=o.constructor)&&r.getDerivedStateFromError!=null&&(o.setState(r.getDerivedStateFromError(t)),s=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,i||{}),s=o.__d),s)return o.__E=o}catch(c){t=c}throw t}},qe=0,Be=function(t){return t!=null&&t.constructor==null},Q.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=C({},this.state),typeof t=="function"&&(t=t(C({},n),this.props)),t&&C(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Oe(this))},Q.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Oe(this))},Q.prototype.render=ce,$=[],Qe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,pe=function(t,e){return t.__v.__b-e.__v.__b},oe.__r=0,Ae=0,he=Ne(!1),ye=Ne(!0);var Tt=0;function a(t,e,n,i,o,r){e||(e={});var s,c,l=e;if("ref"in l)for(c in l={},e)c=="ref"?s=e[c]:l[c]=e[c];var d={type:t,props:l,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--Tt,__i:-1,__u:0,__source:o,__self:r};if(typeof t=="function"&&(s=t.defaultProps))for(c in s)l[c]===void 0&&(l[c]=s[c]);return y.vnode&&y.vnode(d),d}function le(t){throw"never"}const I=class I{static NoteOn(e,n,i){return[I.NoteOnCode|e-1,n,i]}static NoteOff(e,n,i){return[I.NoteOffCode|e-1,n,i]}};F(I,"NoteOnCode",144),F(I,"NoteOffCode",128);let b=I;function et(t,e){if(t!==void 0)for(const n of t.outputs){const i=n[1];if(i.name===e)return i}}async function Dt(t,e,n){await t.open(),new Yt(e).sendCommands(t,n)}const Mt={SIZ:{x:4,y:4,relative:!0},MUL:{x:5,y:4,relative:!0},WRP:{x:6,y:4,relative:!0},SCN:{x:7,y:4,relative:!0}},wt={FM1:{x:4,y:4,relative:!0},FM2:{x:5,y:4,relative:!0},FM3:{x:6,y:4,relative:!0},FM4:{x:7,y:4,relative:!0}},xt={SHF:{x:4,y:4,relative:!0},SWM:{x:5,y:4,relative:!0},WID:{x:6,y:4,relative:!0},SUB:{x:7,y:4,relative:!0}},Pt={PLY:{x:3,y:4,relative:!1},STA:{x:4,y:4,relative:!1},LOP:{x:5,y:4,relative:!1},LEN:{x:6,y:4,relative:!1},DEG:{x:7,y:4,relative:!1},SLI:{x:6,y:5,relative:!1}},Ot={TBR:{x:4,y:4,relative:!0},COL:{x:5,y:4,relative:!0},DEG:{x:6,y:4,relative:!0},RED:{x:7,y:4,relative:!0}},Et={DEL:{x:3,y:0,relative:!1},HOP:{x:5,y:0,relative:!1},RET:{x:0,y:1,relative:!1},REP:{x:1,y:1,relative:!1},RTO:{x:2,y:1,relative:!1},TIC:{x:6,y:2,relative:!1}},Nt={VOL:{x:0,y:4,relative:!0},PIT:{x:1,y:4,relative:!0},FIN:{x:2,y:4,relative:!0},CUT:{x:1,y:5,relative:!0},RES:{x:2,y:5,relative:!0},AMP:{x:3,y:5,relative:!0},PAN:{x:5,y:5,relative:!0},DRY:{x:0,y:6,relative:!1},SCH:{x:1,y:6,relative:!1},SDL:{x:2,y:6,relative:!1},SRV:{x:3,y:6,relative:!1}},Ct={SIZ:{ty:"WAV",code:"SIZ",value:0},MUL:{ty:"WAV",code:"MUL",value:0},WRP:{ty:"WAV",code:"WRP",value:0},SCN:{ty:"WAV",code:"SCN",value:0}},$t={FM1:{ty:"FM",code:"FM1",value:0},FM2:{ty:"FM",code:"FM2",value:0},FM3:{ty:"FM",code:"FM3",value:0},FM4:{ty:"FM",code:"FM4",value:0}},Rt={SHF:{ty:"HS",code:"SHF",value:0},SWM:{ty:"HS",code:"SWM",value:0},WID:{ty:"HS",code:"WID",value:0},SUB:{ty:"HS",code:"SUB",value:0}},Ft={PLY:{ty:"SA",code:"PLY",value:0},STA:{ty:"SA",code:"STA",value:0},LOP:{ty:"SA",code:"LOP",value:0},LEN:{ty:"SA",code:"LEN",value:0},DEG:{ty:"SA",code:"DEG",value:0},SLI:{ty:"SA",code:"SLI",value:0}},It={TBR:{ty:"MA",code:"TBR",value:0},COL:{ty:"MA",code:"COL",value:0},DEG:{ty:"MA",code:"DEG",value:0},RED:{ty:"MA",code:"RED",value:0}},B={VOL:{ty:"GLO",code:"VOL",value:0},PIT:{ty:"GLO",code:"PIT",value:0},FIN:{ty:"GLO",code:"FIN",value:0},CUT:{ty:"GLO",code:"CUT",value:0},RES:{ty:"GLO",code:"RES",value:0},AMP:{ty:"GLO",code:"AMP",value:0},PAN:{ty:"GLO",code:"PAN",value:0},DRY:{ty:"GLO",code:"DRY",value:0},SCH:{ty:"GLO",code:"SCH",value:0},SDL:{ty:"GLO",code:"SDL",value:0},SRV:{ty:"GLO",code:"SRV",value:0}},Ht=["WAV","FM","MA","HS","SA"];function Ut(t){if(t===null)return;const e=Ht.find(n=>n===t);return e||void 0}const tt={WAV:"Wavsynth",MA:"Macrosynth",HS:"Hypersynth",SA:"Sampler",FM:"FM Synth"};function Vt(t){const e=t.ty;switch(e){case"SEQ":return"Sequencer";case"GLO":return"Global";default:return tt[e]}}class h{static DEL(e){return{ty:"SEQ",code:"DEL",value:e}}static REP(e){return{ty:"SEQ",code:"REP",value:e}}static HOP(e){return{ty:"SEQ",code:"HOP",value:e}}static CUT(e){return{ty:"GLO",code:"CUT",value:e}}}function*E(t){for(let e in t)yield t[e]}const nt={WAV:[[...E(Ct)],[...E(B)]],FM:[[...E($t)],[...E(B)]],MA:[[...E(It)],[...E(B)]],HS:[[...E(Rt)],[...E(B)]],SA:[[...E(Ft)],[...E(B)]]};function Wt(t,e,n){let i=0,o=0,r=e,s=0;const c=3,l=2,d=t.canvas.clientHeight,v=S=>{t.fillRect(o*c,d-S,c,l)},u=t.canvas.clientWidth/c;for(;i<n.length&&!(o>=u);){const S=n[i];switch(S.code){case"REP":for(let A=0;A<S.value&&!(o>=u);A++)r=Math.min(255,Math.max(0,r+s)),v(r),o++;break;case"DEL":for(let A=0;A<S.value&&!(o>=u);A++)v(r),o++;break;case"HOP":S.value===i&&(v(r),o++),i=S.value-1;break;default:const _=S.value>128?-(~S.value+1&255):S.value;r=_+r,r=Math.min(255,Math.max(0,r)),v(r),s=_,o++;break}i++}for(;o<u;)v(r),o++}function Gt(t){switch(t.ty){case"SEQ":return Et[t.code];case"GLO":return Nt[t.code];case"WAV":return Mt[t.code];case"FM":return wt[t.code];case"MA":return Ot[t.code];case"HS":return xt[t.code];case"SA":return Pt[t.code];default:return le()}}function*qt(){for(let t=0;t<7;t++)yield 4,yield 4;for(let t=0;t<15;t++)yield 6,yield 6}function*Bt(t){yield 2,yield 3,yield 2,yield 3,yield 2;const e=(t/16|0)*2;for(let i=0;i<e;i++)yield 6;const n=(t&15)*2;for(let i=0;i<n;i++)yield 5;yield 2}function*Qt(t){const e={x:0,y:0};let n=!0;for(const i of t){const o=Gt(i),r=o.x-e.x,s=o.y-e.y,c=r<0?4:5,l=s<0?6:7;yield 2,yield 6,yield 6,n&&(yield*qt(),n=!1);const d=Math.abs(r);for(let u=0;u<2*d;u++)yield c;const v=Math.abs(s);for(let u=0;u<2*v;u++)yield l;yield 2,yield 5,yield 5,yield*Bt(i.value),yield 4,yield 4,yield 7,yield 7,e.x=o.x,e.y=o.y}}class Yt{constructor(e){F(this,"NoteOns");F(this,"NoteOffs");F(this,"keyStates");this.controlChannel=e,this.keyStates=[!1,!1,!1,!1,!1,!1,!1,!1],this.NoteOns=[b.NoteOn(e,0,1),b.NoteOn(e,1,1),b.NoteOn(e,2,1),b.NoteOn(e,3,1),b.NoteOn(e,4,1),b.NoteOn(e,5,1),b.NoteOn(e,6,1),b.NoteOn(e,7,1)],this.NoteOffs=[b.NoteOff(e,0,0),b.NoteOff(e,1,0),b.NoteOff(e,2,0),b.NoteOff(e,3,0),b.NoteOff(e,4,0),b.NoteOff(e,5,0),b.NoteOff(e,6,0),b.NoteOff(e,7,0)]}sendCommands(e,n){this.sendUserCommands(e,Qt(n))}sendUserCommands(e,n){let i=0;const o=23;for(const r of n){const s=this.keyStates[r],c=s?this.NoteOffs:this.NoteOns;this.keyStates[r]=!s,e.send(c[r],window.performance.now()+i*o),i++}}}function*jt(t,e){let n=0;if(e.AttackTics===0)yield{...t,value:e.Amount},n++;else{const i=e.Amount/e.AttackTics|0;yield{...t,value:i},n++,e.AttackTics>1&&(yield h.REP(e.AttackTics-1),n++)}if(e.DecayTics===0)yield{...t,value:x(e.Amount)},n++;else{const i=e.Amount/e.DecayTics|0;yield{...t,value:x(i)},n++,e.DecayTics>1&&(n++,yield h.REP(e.DecayTics-1))}e.Loop?yield h.HOP(0):yield h.HOP(n)}function*zt(t,e){let n=0;if(e.AttackTics===0)yield{...t,value:e.Amount},n++;else{const o=e.Amount/e.AttackTics|0;yield{...t,value:o},n++,e.AttackTics>1&&(yield h.REP(e.AttackTics-1),n++)}const i=e.Amount-e.SustainLevel;if(e.DecayTics===0)yield{...t,value:x(i)},n++;else{const o=i/e.DecayTics|0;yield{...t,value:x(o)},n++,e.DecayTics>1&&(n++,yield h.REP(e.DecayTics-1))}if(yield h.DEL(e.SustainTics),n++,e.ReleaseTics>0){const o=e.SustainLevel/e.ReleaseTics|0;yield{...t,value:x(o)},n++,e.ReleaseTics>1&&(n++,yield h.REP(e.ReleaseTics-1))}else yield{...t,value:x(e.SustainLevel)},n++;e.Loop?yield h.HOP(0):yield h.HOP(n)}function x(t){return(255-t+1)%256}function*Zt(t,e){const n=e.Duration/4|0,i=e.Duration/2|0,o=e.Amount/(e.Duration/2)|0;let r=3;yield{...t,value:o},n>1&&(yield h.REP(n-1),r++),yield{...t,value:x(o)},i>1&&(yield h.REP(i-1),r++),yield{...t,value:o},n>1&&(yield h.REP(n-1),r++),e.Loop?yield h.HOP(0):yield h.HOP(r)}function*Jt(t,e){const n=e.Duration/2|0;let i=1;yield{...t,value:e.Amount/2|0},n>1&&(yield h.DEL(n-1),i++),i++,yield{...t,value:x(e.Amount)},n>1&&(i++,yield h.DEL(n-1)),i++,yield{...t,value:e.Amount},n>1&&(i++,yield h.DEL(n-1)),e.Loop?yield h.HOP(n>1?2:1):yield h.HOP(i)}function*Xt(t,e){let n=2;const i=e.Amount/e.Duration|0;yield{...t,value:i},e.Duration>1&&(yield h.REP(e.Duration),n++),e.Loop?(yield{...t,value:x(e.Amount)},yield h.HOP(0)):yield h.HOP(n)}function*Kt(t,e){let n=2;const i=e.Amount/e.Duration|0;yield{...t,value:e.Amount},yield{...t,value:x(i)},e.Duration>1&&(yield h.REP(e.Duration),n++),e.Loop?yield h.HOP(0):yield h.HOP(n)}function*en(t,e){let n=0;for(const i of e.Segments)if(i.TicDuration<=1)yield{...t,value:i.Amount<0?x(i.Amount):i.Amount|0},n++;else if(i.Amount!==0){const r=(i.Amount<0?Math.abs(i.Amount):i.Amount)/i.TicDuration|0,s=i.Amount<0?x(r):r;yield{...t,value:s},yield h.REP(i.TicDuration-1),n+=2}else yield h.DEL(i.TicDuration);e.Loop?yield h.HOP(0):yield h.HOP(n)}function ee(t){const e=t.get(f.Duration),n=t.get(f.Amount);if(e===null||n===null)return;const i=Number.parseInt(e,16),o=Number.parseInt(n,16),r=t.has(f.Loop);return{Duration:i,Amount:o,Loop:r}}function tn(t,e){e.append(f.Duration,t.Duration.toString(16)),e.append(f.Amount,t.Amount.toString(16)),t.Loop&&e.append(f.Loop,"1")}var f;(t=>{t.Instrument="ins",t.ValueTarget="tgt",t.ValueTargetAmount="tval",t.Kind="knd",t.Attack="att",t.Decay="dec",t.Duration="ln",t.Amount="val",t.Sustain="sus",t.SustainLevel="susv",t.Release="rel",t.Loop="lop",t.SegCount="segs"})(f||(f={}));function nn(t){const e=t.get(f.Attack),n=t.get(f.Decay),i=t.get(f.Amount);if(!(e===null||n==null||i==null))return{AttackTics:Number.parseInt(e,16),DecayTics:Number.parseInt(n,16),Amount:Number.parseInt(i,16),Loop:t.has(f.Loop)}}function on(t,e){e.append(f.Attack,t.AttackTics.toString(16)),e.append(f.Decay,t.DecayTics.toString(16)),e.append(f.Amount,t.Amount.toString(16)),t.Loop&&e.append(f.Loop,"1")}function rn(t){const e=t.get(f.Attack),n=t.get(f.SustainLevel),i=t.get(f.Sustain),o=t.get(f.Decay),r=t.get(f.Amount),s=t.get(f.Release);if(!(e===null||o==null||r==null||n==null||s==null||i==null))return{AttackTics:Number.parseInt(e,16),DecayTics:Number.parseInt(o,16),SustainLevel:Number.parseInt(n,16),SustainTics:Number.parseInt(i,16),Amount:Number.parseInt(r,16),ReleaseTics:Number.parseInt(s,16),Loop:t.has(f.Loop)}}function un(t,e){e.append(f.Attack,t.AttackTics.toString(16)),e.append(f.SustainLevel,t.SustainLevel.toString(16)),e.append(f.Sustain,t.SustainTics.toString(16)),e.append(f.Decay,t.DecayTics.toString(16)),e.append(f.Amount,t.Amount.toString(16)),e.append(f.Release,t.ReleaseTics.toString(16)),t.Loop&&e.append(f.Loop,"1")}function sn(t,e){e.append(f.SegCount,t.Segments.length.toString(16));for(let n=0;n<t.Segments.length;n++){const i=t.Segments[n];e.append(`${f.Amount}${n.toString(16)}`,i.Amount.toString(16)),e.append(`${f.Duration}${n.toString(16)}`,i.TicDuration.toString(16))}t.Loop&&e.append(f.Loop,"1")}function an(t){const e=t.get(f.SegCount);if(e===null)return;const n=Number.parseInt(e,16),i=[];for(let o=0;o<n;o++){const r=t.get(`${f.Amount}${o.toString(16)}`),s=t.get(`${f.Duration}${o.toString(16)}`);if(r===null||s===null)return;i.push({Amount:Number.parseInt(r,16),TicDuration:Number.parseInt(s,16)})}return{Segments:i,Loop:t.has(f.Loop)}}function cn(t){const e=new URLSearchParams;switch(e.append(f.Kind,t.kind),t.kind){case"ad_env":on(t.def,e);break;case"adsr_env":un(t.def,e);break;case"tri_lfo":case"square_lfo":case"ramp_up_lfo":case"ramp_down_lfo":tn(t.def,e);break;case"free":sn(t.def,e);break;default:le()}return e}function ln(t){switch(t.get(f.Kind)){case"ad_env":{const e=nn(t);return e!==void 0?{kind:"ad_env",def:e}:void 0}case"adsr_env":{const e=rn(t);return e!==void 0?{kind:"adsr_env",def:e}:void 0}case"tri_lfo":{const e=ee(t);return e!==void 0?{kind:"tri_lfo",def:e}:void 0}case"square_lfo":{const e=ee(t);return e!==void 0?{kind:"square_lfo",def:e}:void 0}case"ramp_up_lfo":{const e=ee(t);return e!==void 0?{kind:"ramp_up_lfo",def:e}:void 0}case"ramp_down_lfo":{const e=ee(t);return e!==void 0?{kind:"ramp_down_lfo",def:e}:void 0}case"free":{const e=an(t);return e!==void 0?{kind:"free",def:e}:void 0}default:return}}function dn(t,e){switch(e.kind){case"ad_env":return jt(t,e.def);case"adsr_env":return zt(t,e.def);case"tri_lfo":return Zt(t,e.def);case"square_lfo":return Jt(t,e.def);case"ramp_up_lfo":return Xt(t,e.def);case"ramp_down_lfo":return Kt(t,e.def);case"free":return en(t,e.def);default:le()}}const _n={free:0,ad_env:1,adsr_env:2,tri_lfo:3,square_lfo:4,ramp_up_lfo:5,ramp_down_lfo:6};function it(t){switch(t){case 1:return{kind:"ad_env",def:{AttackTics:0,DecayTics:10,Amount:48,Loop:!1}};case 2:return{kind:"adsr_env",def:{AttackTics:7,DecayTics:5,SustainTics:29,ReleaseTics:8,SustainLevel:59,Amount:80,Loop:!1}};case 3:return{kind:"tri_lfo",def:{Duration:40,Amount:62,Loop:!0}};case 4:return{kind:"square_lfo",def:{Duration:40,Amount:62,Loop:!0}};case 5:return{kind:"ramp_up_lfo",def:{Duration:22,Amount:77,Loop:!0}};case 6:return{kind:"ramp_down_lfo",def:{Duration:22,Amount:47,Loop:!0}};case 0:default:return{kind:"free",def:{Segments:[{Amount:40,TicDuration:10}],Loop:!1}}}}var re,M,_e,Ce,me=0,ot=[],L=y,$e=L.__b,Re=L.__r,Fe=L.diffed,Ie=L.__c,He=L.unmount,Ue=L.__;function rt(t,e){L.__h&&L.__h(M,t,me||e),me=0;var n=M.__H||(M.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function fn(t,e){var n=rt(re++,3);!L.__s&&ut(n.__H,e)&&(n.__=t,n.i=e,M.__H.__h.push(n))}function vn(t){return me=5,Te(function(){return{current:t}},[])}function Te(t,e){var n=rt(re++,7);return ut(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function pn(){for(var t;t=ot.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(ie),t.__H.__h.forEach(Se),t.__H.__h=[]}catch(e){t.__H.__h=[],L.__e(e,t.__v)}}L.__b=function(t){M=null,$e&&$e(t)},L.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Ue&&Ue(t,e)},L.__r=function(t){Re&&Re(t),re=0;var e=(M=t.__c).__H;e&&(_e===M?(e.__h=[],M.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.i=n.__N=void 0})):(e.__h.forEach(ie),e.__h.forEach(Se),e.__h=[],re=0)),_e=M},L.diffed=function(t){Fe&&Fe(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(ot.push(e)!==1&&Ce===L.requestAnimationFrame||((Ce=L.requestAnimationFrame)||hn)(pn)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.i=void 0})),_e=M=null},L.__c=function(t,e){e.some(function(n){try{n.__h.forEach(ie),n.__h=n.__h.filter(function(i){return!i.__||Se(i)})}catch(i){e.some(function(o){o.__h&&(o.__h=[])}),e=[],L.__e(i,n.__v)}}),Ie&&Ie(t,e)},L.unmount=function(t){He&&He(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{ie(i)}catch(o){e=o}}),n.__H=void 0,e&&L.__e(e,n.__v))};var Ve=typeof requestAnimationFrame=="function";function hn(t){var e,n=function(){clearTimeout(i),Ve&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(n,100);Ve&&(e=requestAnimationFrame(n))}function ie(t){var e=M,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),M=e}function Se(t){var e=M;t.__c=t.__(),M=e}function ut(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}var yn=Symbol.for("preact-signals");function De(){if(H>1)H--;else{for(var t,e=!1;Y!==void 0;){var n=Y;for(Y=void 0,ge++;n!==void 0;){var i=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&at(n))try{n.c()}catch(o){e||(t=o,e=!0)}n=i}}if(ge=0,H--,e)throw t}}var m=void 0,Y=void 0,H=0,ge=0,ue=0;function st(t){if(m!==void 0){var e=t.n;if(e===void 0||e.t!==m)return e={i:0,S:t,p:m.s,n:void 0,t:m,e:void 0,x:void 0,r:e},m.s!==void 0&&(m.s.n=e),m.s=e,t.n=e,32&m.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=m.s,e.n=void 0,m.s.n=e,m.s=e),e}}function D(t){this.v=t,this.i=0,this.n=void 0,this.t=void 0}D.prototype.brand=yn;D.prototype.h=function(){return!0};D.prototype.S=function(t){this.t!==t&&t.e===void 0&&(t.x=this.t,this.t!==void 0&&(this.t.e=t),this.t=t)};D.prototype.U=function(t){if(this.t!==void 0){var e=t.e,n=t.x;e!==void 0&&(e.x=n,t.e=void 0),n!==void 0&&(n.e=e,t.x=void 0),t===this.t&&(this.t=n)}};D.prototype.subscribe=function(t){var e=this;return we(function(){var n=e.value,i=m;m=void 0;try{t(n)}finally{m=i}})};D.prototype.valueOf=function(){return this.value};D.prototype.toString=function(){return this.value+""};D.prototype.toJSON=function(){return this.value};D.prototype.peek=function(){var t=m;m=void 0;try{return this.value}finally{m=t}};Object.defineProperty(D.prototype,"value",{get:function(){var t=st(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(ge>100)throw new Error("Cycle detected");this.v=t,this.i++,ue++,H++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{De()}}}});function R(t){return new D(t)}function at(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function ct(t){for(var e=t.s;e!==void 0;e=e.n){var n=e.S.n;if(n!==void 0&&(e.r=n),e.S.n=e,e.i=-1,e.n===void 0){t.s=e;break}}}function lt(t){for(var e=t.s,n=void 0;e!==void 0;){var i=e.p;e.i===-1?(e.S.U(e),i!==void 0&&(i.n=e.n),e.n!==void 0&&(e.n.p=i)):n=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=i}t.s=n}function V(t){D.call(this,void 0),this.x=t,this.s=void 0,this.g=ue-1,this.f=4}(V.prototype=new D).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===ue))return!0;if(this.g=ue,this.f|=1,this.i>0&&!at(this))return this.f&=-2,!0;var t=m;try{ct(this),m=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(n){this.v=n,this.f|=16,this.i++}return m=t,lt(this),this.f&=-2,!0};V.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}D.prototype.S.call(this,t)};V.prototype.U=function(t){if(this.t!==void 0&&(D.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};V.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};Object.defineProperty(V.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=st(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function dt(t){return new V(t)}function _t(t){var e=t.u;if(t.u=void 0,typeof e=="function"){H++;var n=m;m=void 0;try{e()}catch(i){throw t.f&=-2,t.f|=8,Me(t),i}finally{m=n,De()}}}function Me(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,_t(t)}function mn(t){if(m!==this)throw new Error("Out-of-order effect");lt(this),m=t,this.f&=-2,8&this.f&&Me(this),De()}function z(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}z.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{t()}};z.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,_t(this),ct(this),H++;var t=m;return m=this,mn.bind(this,t)};z.prototype.N=function(){2&this.f||(this.f|=2,this.o=Y,Y=this)};z.prototype.d=function(){this.f|=8,1&this.f||Me(this)};function we(t){var e=new z(t);try{e.c()}catch(n){throw e.d(),n}return e.d.bind(e)}var fe;function W(t,e){y[t]=e.bind(null,y[t]||function(){})}function se(t){fe&&fe(),fe=t&&t.S()}function ft(t){var e=this,n=t.data,i=gn(n);i.value=n;var o=Te(function(){for(var r=e.__v;r=r.__;)if(r.__c){r.__c.__$f|=4;break}return e.__$u.c=function(){var s;!Be(o.peek())&&((s=e.base)==null?void 0:s.nodeType)===3?e.base.data=o.peek():(e.__$f|=1,e.setState({}))},dt(function(){var s=i.value.value;return s===0?0:s===!0?"":s||""})},[]);return o.value}ft.displayName="_st";Object.defineProperties(D.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:ft},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});W("__b",function(t,e){if(typeof e.type=="string"){var n,i=e.props;for(var o in i)if(o!=="children"){var r=i[o];r instanceof D&&(n||(e.__np=n={}),n[o]=r,i[o]=r.peek())}}t(e)});W("__r",function(t,e){se();var n,i=e.__c;i&&(i.__$f&=-2,(n=i.__$u)===void 0&&(i.__$u=n=function(o){var r;return we(function(){r=this}),r.c=function(){i.__$f|=1,i.setState({})},r}())),se(n),t(e)});W("__e",function(t,e,n,i){se(),t(e,n,i)});W("diffed",function(t,e){se();var n;if(typeof e.type=="string"&&(n=e.__e)){var i=e.__np,o=e.props;if(i){var r=n.U;if(r)for(var s in r){var c=r[s];c!==void 0&&!(s in i)&&(c.d(),r[s]=void 0)}else n.U=r={};for(var l in i){var d=r[l],v=i[l];d===void 0?(d=Sn(n,l,v,o),r[l]=d):d.o(v,o)}}}t(e)});function Sn(t,e,n,i){var o=e in t&&t.ownerSVGElement===void 0,r=R(n);return{o:function(s,c){r.value=s,i=c},d:we(function(){var s=r.value.value;i[e]!==s&&(i[e]=s,o?t[e]=s:s?t.setAttribute(e,s):t.removeAttribute(e))})}}W("unmount",function(t,e){if(typeof e.type=="string"){var n=e.__e;if(n){var i=n.U;if(i){n.U=void 0;for(var o in i){var r=i[o];r&&r.d()}}}}else{var s=e.__c;if(s){var c=s.__$u;c&&(s.__$u=void 0,c.d())}}t(e)});W("__h",function(t,e,n,i){(i<3||i===9)&&(e.__$f|=2),t(e,n,i)});Q.prototype.shouldComponentUpdate=function(t,e){var n=this.__$u;if(!(n&&n.s!==void 0||4&this.__$f)||3&this.__$f)return!0;for(var i in e)return!0;for(var o in t)if(o!=="__source"&&t[o]!==this.props[o])return!0;for(var r in this.props)if(!(r in t))return!0;return!1};function gn(t){return Te(function(){return R(t)},[])}function An(t,e){const n=nt[t];for(const i of n)for(const o of i)if(o.code===e)return o}function vt(t){const e=new URL(document.location.href).searchParams,n=Ut(e.get(f.Instrument))||"MA",i=ln(e)||it(2),o=e.get(f.ValueTargetAmount),r=o!==null?Math.max(0,Math.min(255,Number.parseInt(o,10))):80,s=e.get(f.ValueTarget)||"CUT",c=An(n,s)||h.CUT(r),l=R({...c,value:r}),d=R(i),v=dt(()=>[...dn(l.value,d.value)]);return{current_instrument:R(n),current_parameter:l,current_macro:d,script:v,midi:t,m8Channel:R(10),m8port:R(void 0)}}let p=vt(void 0);function w(t){const e=o=>{const r=Number.parseInt(o,10);t.update(r)},n=t.max===void 0?255:t.max,i=t.min===void 0?0:t.min;return a("div",{class:"valueEdit",children:[a("label",{children:t.name}),a("br",{}),a("input",{type:"range",min:i,max:n,onInput:o=>e(o.currentTarget.value),value:t.val}),a("input",{type:"number",min:i,max:n,onInput:o=>e(o.currentTarget.value),value:t.val})]})}function kn(t){const e=t.def;return a("form",{children:[a("h3",{children:t.name}),a(w,{name:"Attack (tics)",val:e.AttackTics,update:n=>t.update({...e,AttackTics:n})}),a(w,{name:"Decay (tics)",val:e.DecayTics,update:n=>t.update({...e,DecayTics:n})}),a(w,{name:"Amount",val:e.Amount,update:n=>t.update({...e,Amount:n})}),a("label",{children:"Loop"}),a("input",{type:"checkbox",checked:e.Loop,onInput:n=>t.update({...e,Loop:!e.Loop})})]})}function Ln(t){const e=t.def;return a("form",{children:[a("h3",{children:t.name}),a(w,{name:"Amount",val:e.Amount,update:n=>t.update({...e,Amount:n})}),a(w,{name:"Attack (tics)",val:e.AttackTics,update:n=>t.update({...e,AttackTics:n})}),a(w,{name:"Decay (tics)",val:e.DecayTics,update:n=>t.update({...e,DecayTics:n})}),a(w,{name:"Sustain (tics)",val:e.SustainTics,update:n=>t.update({...e,SustainTics:n})}),a(w,{name:"Sustain Amount",val:e.SustainLevel,update:n=>t.update({...e,SustainLevel:n})}),a(w,{name:"Release (tics)",val:e.ReleaseTics,update:n=>t.update({...e,ReleaseTics:n})}),a("label",{children:"Loop"}),a("input",{type:"checkbox",checked:e.Loop,onInput:n=>t.update({...e,Loop:!e.Loop})})]})}function te(t){const e=t.def;return a("form",{children:[a("h3",{children:t.name}),a(w,{name:"Duration (tics)",val:e.Duration,update:n=>t.update({...e,Duration:n})}),a(w,{name:"Amount",val:e.Amount,update:n=>t.update({...e,Amount:n}),max:t.maxAmount}),a("label",{children:"Loop"}),a("input",{type:"checkbox",checked:e.Loop,onInput:n=>t.update({...e,Loop:!e.Loop})})]})}function bn(t){const e=t.seg;return a("form",{class:"segmentedit",children:[a(w,{name:"Duration (tics)",val:e.TicDuration,update:n=>t.update({...e,TicDuration:n})}),a(w,{name:"Amount",val:e.Amount,min:-128,max:127,update:n=>t.update({...e,Amount:n})}),a("button",{title:"Remove segment",onClick:()=>t.remove(),children:"Remove"})]})}function Tn(t){const e=t.def,n=()=>t.update({...e,Segments:[...e.Segments,{Amount:10,TicDuration:10}]}),i=e.Segments.map((o,r)=>a(bn,{seg:o,update:l=>{const d=[...e.Segments];d[r]=l,t.update({...e,Segments:d})},remove:()=>{const l=[...e.Segments];l.splice(r,1),t.update({...e,Segments:l})}}));return a("div",{children:[a("h3",{children:t.name}),a("div",{class:"segmentList",children:i}),a("button",{title:"Add a segment",onClick:o=>n(),children:"+"}),a("label",{children:"Loop"}),a("input",{type:"checkbox",checked:e.Loop,onInput:o=>t.update({...e,Loop:!e.Loop})})]})}function We(t){const e=t.toString(16);return e.length<2?"0"+e:e}function Dn(t,e){const n=`${We(t)} : ${e.code} ${We(e.value)}
`;return t===15?a("span",{class:"warncolor",title:"Beware approaching instruction count limit...",children:n}):t>15?a("span",{class:"errorcolor",title:"Out of bound instruction, cannot be executed.",children:n}):n}function Mn(){const t=p.script.value;return a("pre",{children:t.map((e,n)=>Dn(n,e))})}function wn(){const t=p.current_macro.value;switch(t.kind){case"free":return a(Tn,{name:"Free form",def:t.def,update:n=>{const i={...t,def:n};p.current_macro.value=i}});case"ad_env":return a(kn,{name:"Attack Decay Enveloppe",def:t.def,update:n=>{const i={...t,def:n};p.current_macro.value=i}});case"adsr_env":return a(Ln,{name:"ADSR Enveloppe",def:t.def,update:n=>{const i={...t,def:n};p.current_macro.value=i}});case"tri_lfo":return a(te,{name:"Triangle LFO",def:t.def,update:n=>{const i={...t,def:n};p.current_macro.value=i}});case"square_lfo":return a(te,{name:"Square LFO",def:t.def,maxAmount:127,update:n=>{const i={...t,def:n};p.current_macro.value=i}});case"ramp_up_lfo":return a(te,{name:"Ramp UP LFO",def:t.def,update:n=>{const i={...t,def:n};p.current_macro.value=i}});case"ramp_down_lfo":return a(te,{name:"Ramp Down LFO",def:t.def,update:n=>{const i={...t,def:n};p.current_macro.value=i}});default:le()}}function xn(){const t=_n[p.current_macro.value.kind],e=o=>{p.current_macro.value=it(o)},n=["Free","Attack Decay Env","ADSR Env","Triangle LFO","Square LFO","Ramp up LFO","Ramp down LFO"],i=(o,r)=>a("div",{children:a("label",{children:[a("input",{type:"radio",checked:t===r,onInput:s=>e(r)}),o]})});return a("div",{children:n.map(i)})}function Pn(){const t=vn(null),e=p.script.value,n=p.current_parameter.value;return fn(()=>{const i=t.current;if(i===null)return;const o=i.getContext("2d");if(o===null)return;const r=o.canvas.clientWidth,s=o.canvas.clientHeight;o.clearRect(0,0,r,s),o.fillStyle="#555";for(var c=1;c<255;c+=16)o.fillRect(0,c,r,1);o.fillStyle="#080",o.fillRect(0,255-n.value,r,2),o.fillStyle="#fff",Wt(o,n.value,e)},[e]),a("div",{children:a("canvas",{class:"visualization",ref:t,width:640,height:258})})}function On(){const t=p.current_instrument.value,e=n=>a("div",{children:a("label",{children:[a("input",{type:"radio",value:n,checked:n===t,onInput:i=>p.current_instrument.value=n}),tt[n]]})});return a("div",{children:[e("WAV"),e("MA"),e("HS"),e("SA"),e("FM")]})}function En(){const t=p.current_instrument.value,e=p.current_parameter.value,n=nt[t];let i=[];const o=l=>{const d=Number.parseInt(l,10),v=i[d];p.current_parameter.value={...v,value:e.value}};let r=0;const s=l=>(i.push(l),a("option",{value:r++,selected:e.code===l.code,children:[" ",l.code," "]})),c=n.map(l=>a("optgroup",{label:Vt(l[0]),children:l.map(s)}));return a("select",{size:20,onChange:l=>o(l.currentTarget.value),children:c})}function Nn(){const t=p.current_parameter.value;return a(w,{name:"Amount",val:t.value,update:e=>p.current_parameter.value={...t,value:e}})}function pt(){if(p.midi===void 0)return;const t=et(p.midi,"M8");p.m8port.value=t==null?void 0:t.id}function Cn(){const t=p.m8Channel.value,e=p.m8port.value;if(p.midi===void 0)return a("div",{class:"message",children:"No midi allowed, cannot write to M8, grant MIDI rights and refresh page"});const n=e===void 0?"No connected M8 found":"M8 OK, put cursor in an instrument table for writing.",i=o=>{const r=Number.parseInt(o,10);p.m8Channel.value=r};return a("div",{class:"message",children:[a("span",{class:"midistatus",children:n}),a("span",{class:"separator"}),a("label",{children:[a("span",{class:"midistatus",children:"M8 control channel : "}),a("input",{type:"number",min:"1",max:"16",title:"M8 Midi control channel (10 by default)",value:t,onInput:o=>i(o.currentTarget.value)})]}),a("span",{class:"separator"}),a("button",{title:"Search for M8",onClick:o=>pt(),children:"⟳ Refresh M8"})]})}function $n(){const t=et(p.midi,"M8");if(t===void 0){p.m8port.value=void 0,alert("No M8 found, please connect and refresh");return}Dt(t,p.m8Channel.peek(),p.script.peek())}function Rn(){const t=p.script.value.length>15,e=p.m8port.value===void 0||t;return a("div",{children:[a("div",{class:"rootheader",children:[a("h1",{children:"M8 Table generator"}),a(Cn,{})]}),a("div",{class:"rootcontainer",children:[a("div",{class:"rootcolumn",children:[a("h3",{children:"Generator"}),a(xn,{}),a("h3",{children:"Instrument"}),a(On,{}),a("h3",{children:"Value"}),a(Nn,{}),a(En,{})]}),a("div",{class:"rootcolumn",children:a(wn,{})}),a("div",{class:"rootcolumn",children:[a("h3",{children:"M8 'script'"}),a(Mn,{}),a(Pn,{}),a("div",{children:[a("button",{disabled:e,onClick:n=>$n(),children:"M8 write"}),t?"Your script is too long and can't be executed on a M8":""]})]})]})]})}function Ge(){if(!window.history.pushState)return;var t=new URL(window.location.href);const e=p.current_macro.value;var n=cn(e);n.append(f.Instrument,p.current_instrument.value);const i=p.current_parameter.value;n.append(f.ValueTarget,i.code),n.append(f.ValueTargetAmount,i.value.toString()),t.search=n.toString();const o=t.toString();window.history.replaceState({url:o},"",o)}function ve(){p.script.subscribe(Ge),p.current_instrument.subscribe(Ge),bt(a(Rn,{}),document.getElementById("app"))}try{navigator.requestMIDIAccess().then(t=>{p=vt(t),pt(),ve()},t=>{ve()})}catch{document.addEventListener("DOMContentLoaded",function(){ve()},!1)}
